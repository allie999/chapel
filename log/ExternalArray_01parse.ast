AST dump for ExternalArray after pass parse.
Module use list: 

{
  (188555 'use' ChapelStandard)
  type chpl_opaque_array[188575] unknown _pid[188560] int[13] unknown _instance[188565] c_void_ptr unknown _unowned[188570] bool[10]
  type chpl_external_array[188595] unknown elts[188580] c_void_ptr unknown num_elts[188585] uint[115] unknown freer[188590] c_void_ptr
  function chpl_make_external_array[188604](arg elt_size[188601] :
  uint[115], arg num_elts[188607] :
  uint[115]) : _unknown[51] "extern" "local args" "no fn body"
  {
  }
  { scopeless type
    chpl_external_array
  }
  function chpl_make_external_array_ptr[188620](arg elts[188617] :
  c_void_ptr, arg num_elts[188623] :
  uint[115]) : _unknown[51] "extern" "local args" "no fn body"
  {
  }
  { scopeless type
    chpl_external_array
  }
  function chpl_make_external_array_ptr_free[188636](arg elts[188633] :
  c_void_ptr, arg num_elts[188639] :
  uint[115]) : _unknown[51] "extern" "local args" "no fn body"
  {
  }
  { scopeless type
    chpl_external_array
  }
  function chpl_free_external_array[188652](in arg x[188649] :
  chpl_external_array) : void[4] "extern" "local args" "no fn body"
  {
  }
  function chpl_call_free_func[188662](arg func[188659] :
  c_void_ptr, arg elts[188665] :
  c_void_ptr) : void[4] "extern" "local args" "no fn body"
  {
  }
  function makeArrayFromPtr[188676](arg value[188673] :
  c_ptr, arg num_elts[188679] :
  uint[115]) : _unknown[51] "no copy return"
  {
    { scopeless
      unknown data[188690](188689 call chpl_make_external_array_ptr(188685 call _cast c_void_ptr value) num_elts)
      (188693 'end of statement')
    }
    (188703 return(188702 call makeArrayFromExternArray data(188699 call . value c"eltType")))
  }
  function makeArrayFromExternArray[188713](arg value[188710] :
  chpl_external_array, arg eltType[188715]:_any[178](?)) : _unknown[51] "no copy return"
  {
    { scopeless
      unknown dom[188743](188742 call(188718 call . defaultDist c"dsiNewRectangularDom")(rank = 1)(idxType = int[13])(stridable = 0)(inds =(188739 call _build_tuple(188737 call #(188729 call chpl_build_low_bounded_range 0)(188734 call . value c"num_elts")))))
      (188746 'end of statement')
    }
    (188753 call =(188749 call . dom c"_free_when_no_arrs") 1)
    { scopeless
      unknown arr[188802](188758 'new'(_chpl_manager = unmanaged[220](?))(188801 call DefaultRectangularArr(eltType = eltType)(rank = 1)(idxType =(188766 call . dom c"idxType"))(stridable =(188771 call . dom c"stridable"))(dom = dom)(data =(188787 call _cast(188786 call _ddata eltType)(188780 call . value c"elts")))(externFreeFunc =(188793 call . value c"freer"))(externArr = 1)(_borrowed = 1)))
      (188805 'end of statement')
    }
    (188814 call(188807 call . dom c"add_arr") arr(locking = 0))
    (188820 return(188819 call _newArray arr))
  }
  function makeArrayFromOpaque[188830](arg value[188827] :
  chpl_opaque_array, arg arrType[188832]:_any[178](?)) : _unknown[51] "no copy return"
  {
    { scopeless
      unknown asArrType[188842](188840 call _cast(188839 'to nilable class from type' arrType)(188835 call . value c"_instance"))
      (188845 'end of statement')
    }
    if(188872 call _cond_test(188849 call == asArrType nil[44]))
    {
      { scopeless
        (188870 call halt "nil array passed to makeArrayFromOpaque")
      }
    }
    { scopeless
      unknown asNonNilArrType[188882](188881 'try!-expr'(188879 call _cast arrType asArrType))
      (188885 'end of statement')
    }
    { scopeless
      unknown ret[188890](188889 call _newArray asNonNilArrType)
      (188893 'end of statement')
    }
    (188902 call =(188895 call . ret c"_pid")(188899 call . value c"_pid"))
    (188910 call =(188906 call . ret c"_unowned") 1)
    (188914 return ret)
  }
  function convertStringOrBytes[188926](ref arg arr[188923] :
  (188920 call chpl__buildArrayRuntimeType nil[44])) : _unknown[51]
  {
    { scopeless
      unknown wrapper[188955](188953 call chpl__buildArrayRuntimeType(188951 call chpl__ensureDomainExpr(188946 call . arr c"_dom")) chpl_byte_buffer)
      (188958 'end of statement')
    }
    {
      unknown _indexOfInterest[188995] "an _indexOfInterest or chpl__followIdx variable" "temp"
      unknown _iterator[188996] "expr temp" "temp"
      (189005 'move' _iterator[188996](189003 call _getIterator(189015 call chpl_direct_counted_range_iter 0(189011 call . arr c"size"))))
      Defer
      {
        {
          (189031 call _freeIterator _iterator[188996])
        }
      }
      { scopeless type
        (189020 'move' _indexOfInterest[188995](189017 call iteratorIndex _iterator[188996]))
      }
      ForLoop[188997]
      {
        unknown i[189024] "index var" "insert auto destroy"
        (189026 'move' i[189024] _indexOfInterest[188995])
        {
          { scopeless
            unknown item[188974] "ref var"(188973 call arr i)
            (188977 'end of statement')
          }
          { scopeless
            unknown val[188983](188982 call chpl__exportRetStringOrBytes item)
            (188986 'end of statement')
          }
          (188992 call =(188990 call wrapper i) val)
        }
        label _continueLabel[189000]
        _indexOfInterest[188995]
        _iterator[188996]
      }
      label _breakLabel[189001]
    }
    { scopeless
      unknown ext[189055](189054 call chpl_make_external_array_ptr_free(189045 call c_ptrTo(189043 call wrapper 0))(189052 call _cast uint[115](189048 call . wrapper c"size")))
      (189058 'end of statement')
    }
    (189060 return ext)
  }
  where {
    (188943 call ||(188934 call ==(188930 call . arr c"eltType") string[26])(188941 call ==(188937 call . arr c"eltType") bytes[24]))
  }
  { scopeless type
    chpl_external_array
  }
  function convertToExternalArray[189074](in arg arr[189071] :
  (189068 call chpl__buildArrayRuntimeType nil[44])) : _unknown[51]
  {
    if(189127 call _cond_test(189091 call !(189090 call isExternArrEltType(189086 call . arr c"eltType"))))
    {
      (189094 'use' HaltWrappers)
      (189125 call safeCastCheckHalt(189122 call + "Cannot build an external array that stores "(189120 call _cast string[26](189116 call . arr c"eltType"))))
    }
    if(189185 call _cond_test(189142 call !(189141 call isIntegralType(189137 call .(189134 call . arr c"_dom") c"idxType"))))
    {
      (189182 call compilerError(189179 call + "cannot return an array with indices that are not " "integrals"))
    }
    if(189218 call _cond_test(189193 call .(189190 call . arr c"_dom") c"stridable"))
    {
      (189215 call compilerError "cannot return a strided array")
    }
    if(189254 call _cond_test(189230 call !=(189226 call .(189223 call . arr c"_dom") c"rank") 1))
    {
      (189251 call compilerError "cannot return an array with rank != 1")
    }
    if(189290 call _cond_test(189266 call !=(189262 call .(189259 call . arr c"_dom") c"low") 0))
    {
      (189287 call halt "cannot return an array when the lower bounds is not 0")
    }
    if(189316 call _cond_test(189308 call ||(189299 call ==(189295 call . arr c"eltType") string[26])(189306 call ==(189302 call . arr c"eltType") bytes[24])))
    {
      { scopeless
        (189314 return(189313 call convertStringOrBytes arr))
      }
    }
    { scopeless
      unknown externalArr[189338](189337 call chpl_make_external_array_ptr_free(189328 call c_ptrTo(189326 call arr 0))(189335 call _cast uint[115](189331 call . arr c"size")))
      (189341 'end of statement')
    }
    (189347 call =(189343 call . arr c"externArr") 1)
    (189355 call =(189351 call . arr c"_borrowed") 1)
    (189359 return externalArr)
  }
  where {
    (189082 call ==(189080 call getExternalArrayType arr) chpl_external_array)
  }
  { scopeless type
    chpl_external_array
  }
  function convertToExternalArray[189373](arg arr[189370] :
  (189367 call chpl__buildArrayRuntimeType nil[44])) : _unknown[51]
  {
    { scopeless
      unknown ret[189384] chpl_opaque_array
      (189387 'end of statement')
    }
    (189397 call =(189390 call . ret c"_pid")(189394 call . arr c"_pid"))
    (189411 call =(189401 call . ret c"_instance")(189409 call _cast c_void_ptr(189405 call . arr c"_value")))
    (189422 call =(189415 call . ret c"_unowned")(189419 call . arr c"_unowned"))
    if(189440 call _cond_test(189429 call !(189426 call . arr c"_unowned")))
    {
      (189436 call =(189432 call . arr c"_unowned") 1)
    }
    (189445 return ret)
  }
  where {
    (189381 call ==(189379 call getExternalArrayType arr) chpl_opaque_array)
  }
  { scopeless type
    chpl_opaque_array
  }
  function isExternArrEltType[189455](arg t[189453]:_any[178](?)) param : _unknown[51] "private"
  {
    if(189510 call _cond_test(189460 call isPrimitive t))
    {
      (189462 return 1)
    }
    {
      { scopeless
        if(189505 call _cond_test(189467 call == t c_string))
        {
          (189470 return 1)
        }
        {
          { scopeless
            if(189501 call _cond_test(189492 'is extern type' t))
            {
              (189494 return 1)
            }
            {
              (189498 return 0)
            }
          }
        }
      }
    }
  }
  function getExternalArrayType[189522](arg arg[189520]:_any[178](?)) type : _unknown[51]
  {
    if(189575 call _cond_test(189529 call !(189528 call isArrayType(189526 'typeof' arg))))
    {
      (189550 call compilerError "must call with an array")
    }
    {
      if(189570 call _cond_test(189561 call(189557 call .(189554 call . arg c"_value") c"isDefaultRectangular")))
      {
        (189563 return chpl_external_array)
      }
      {
        (189567 return chpl_opaque_array)
      }
    }
  }
  function getExternalArrayType[189586](arg arg[189584]:_any[178](?)) type : _unknown[51]
  {
    if(189634 call _cond_test(189592 call !(189591 call isArrayType arg)))
    {
      (189597 call compilerError "must call with an array")
    }
    {
      unknown _instanceType[189605] "type variable"(189604 'static field type' arg "_instance")
      unknown borrowedAlt[189613] "type variable"(189612 call _to_borrowed _instanceType)
      if(189630 call _cond_test(189621 call(189617 call . borrowedAlt c"isDefaultRectangular")))
      {
        (189623 return chpl_external_array)
      }
      {
        (189627 return chpl_opaque_array)
      }
    }
  }
  function cleanupOpaqueArray[189647](const  ref arg arr[189644] :
  chpl_opaque_array) : _unknown[51] "export" "local args"
  {
    { scopeless
      unknown cleanup[189658](189656 call _cast(189655 'to unmanaged class from unknown'(189654 'to nilable class from type' BaseArr))(189650 call . arr c"_instance"))
      (189661 'end of statement')
    }
    if(189675 call _cond_test cleanup)
    {
      { scopeless
        (189673 call _do_destroy_arr(189666 call . arr c"_unowned")(189671 call postfix! cleanup))
      }
    }
  }
}