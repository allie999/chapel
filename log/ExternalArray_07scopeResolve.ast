AST dump for ExternalArray after pass scopeResolve.
Module use list: ChapelStandard HaltWrappers 

{
  type chpl_opaque_array[188575] unknown _pid[188560] int(64)[13] unknown _instance[188565] c_void_ptr[149] unknown _unowned[188570] bool[10]
  type chpl_external_array[188595] unknown elts[188580] c_void_ptr[149] unknown num_elts[188585] uint(64)[115] unknown freer[188590] c_void_ptr[149]
  function chpl_make_external_array[188604](arg elt_size[188601] :
  uint(64)[115], arg num_elts[188607] :
  uint(64)[115]) : _unknown[51] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  { scopeless type
    chpl_external_array[188595]
  }
  function chpl_make_external_array_ptr[188620](arg elts[188617] :
  c_void_ptr[149], arg num_elts[188623] :
  uint(64)[115]) : _unknown[51] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  { scopeless type
    chpl_external_array[188595]
  }
  function chpl_make_external_array_ptr_free[188636](arg elts[188633] :
  c_void_ptr[149], arg num_elts[188639] :
  uint(64)[115]) : _unknown[51] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  { scopeless type
    chpl_external_array[188595]
  }
  function chpl_free_external_array[188652](in arg x[188649] :
  chpl_external_array[188595]) : void[4] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  function chpl_call_free_func[188662](arg func[188659] :
  c_void_ptr[149], arg elts[188665] :
  c_void_ptr[149]) : void[4] "extern" "local args" "no fn body" "no return value for void"
  {
  }
  function makeArrayFromPtr[188676](arg value[188673] :
  c_ptr[205045](?), arg num_elts[188679] :
  uint(64)[115]) : _unknown[51] "no copy return"
  {
    unknown data[188690](188689 call chpl_make_external_array_ptr(188685 call _cast c_void_ptr[149] value[188673]) num_elts[188679])
    (188693 'end of statement')
    (188703 return(188702 call makeArrayFromExternArray data[188690](188699 call . value[188673] c"eltType")))
  }
  function makeArrayFromExternArray[188713](arg value[188710] :
  chpl_external_array[188595], arg eltType[188715]:_any[178](?)) : _unknown[51] "no copy return"
  {
    unknown dom[188743](188742 call(188718 call . defaultDist[94050] c"dsiNewRectangularDom")(rank = 1)(idxType = int(64)[13])(stridable = 0)(inds =(188739 call _build_tuple(188737 call #(188729 call chpl_build_low_bounded_range 0)(188734 call . value[188710] c"num_elts")))))
    (188746 'end of statement')
    (188753 call =(188749 call . dom[188743] c"_free_when_no_arrs") 1)
    unknown arr[188802](188758 'new'(_chpl_manager = unmanaged[220](?))(188801 call DefaultRectangularArr[379605](?)(eltType = eltType[188715])(rank = 1)(idxType =(188766 call . dom[188743] c"idxType"))(stridable =(188771 call . dom[188743] c"stridable"))(dom = dom[188743])(data =(188787 call _cast(188786 call _ddata[11695](?) eltType[188715])(188780 call . value[188710] c"elts")))(externFreeFunc =(188793 call . value[188710] c"freer"))(externArr = 1)(_borrowed = 1)))
    (188805 'end of statement')
    (188814 call(188807 call . dom[188743] c"add_arr") arr[188802](locking = 0))
    (188820 return(188819 call _newArray arr[188802]))
  }
  function makeArrayFromOpaque[188830](arg value[188827] :
  chpl_opaque_array[188575], arg arrType[188832]:_any[178](?)) : _unknown[51] "no copy return"
  {
    unknown asArrType[188842](188840 call _cast(188839 'to nilable class from type' arrType[188832])(188835 call . value[188827] c"_instance"))
    (188845 'end of statement')
    if(188872 call _cond_test(188849 call == asArrType[188842] nil[44]))
    {
      (188870 call halt "nil array passed to makeArrayFromOpaque")
    }
    unknown asNonNilArrType[188882](188881 'try!-expr'(188879 call _cast arrType[188832] asArrType[188842]))
    (188885 'end of statement')
    unknown ret[188890](188889 call _newArray asNonNilArrType[188882])
    (188893 'end of statement')
    (188902 call =(188895 call . ret[188890] c"_pid")(188899 call . value[188827] c"_pid"))
    (188910 call =(188906 call . ret[188890] c"_unowned") 1)
    (188914 return ret[188890])
  }
  function convertStringOrBytes[188926](ref arg arr[188923] :
  (188920 call chpl__buildArrayRuntimeType nil[44])) : _unknown[51]
  {
    unknown wrapper[188955](188953 call chpl__buildArrayRuntimeType(188951 call chpl__ensureDomainExpr(188946 call . arr[188923] c"_dom")) chpl_byte_buffer[172131])
    (188958 'end of statement')
    {
      unknown _indexOfInterest[188995] "an _indexOfInterest or chpl__followIdx variable" "temp"
      unknown _iterator[188996] "expr temp" "temp"
      (189005 'move' _iterator[188996](189003 call _getIterator(189015 call chpl_direct_counted_range_iter 0(189011 call . arr[188923] c"size"))))
      Defer
      {
        {
          (189031 call _freeIterator _iterator[188996])
        }
      }
      { scopeless type
        (189020 'move' _indexOfInterest[188995](189017 call iteratorIndex _iterator[188996]))
      }
      ForLoop[188997]
      {
        unknown i[189024] "index var" "insert auto destroy"
        (189026 'move' i[189024] _indexOfInterest[188995])
        {
          unknown item[188974] "ref var"(188973 call arr[188923] i[189024])
          (188977 'end of statement')
          unknown val[188983](188982 call chpl__exportRetStringOrBytes item[188974])
          (188986 'end of statement')
          (188992 call =(188990 call wrapper[188955] i[189024]) val[188983])
        }
        label _continueLabel[189000]
        _indexOfInterest[188995]
        _iterator[188996]
      }
      label _breakLabel[189001]
    }
    unknown ext[189055](189054 call chpl_make_external_array_ptr_free(189045 call c_ptrTo(189043 call wrapper[188955] 0))(189052 call _cast uint(64)[115](189048 call . wrapper[188955] c"size")))
    (189058 'end of statement')
    (189060 return ext[189055])
  }
  where {
    (188943 call ||(188934 call ==(188930 call . arr[188923] c"eltType") string[26])(188941 call ==(188937 call . arr[188923] c"eltType") bytes[24]))
  }
  { scopeless type
    chpl_external_array[188595]
  }
  function convertToExternalArray[189074](in arg arr[189071] :
  (189068 call chpl__buildArrayRuntimeType nil[44])) : _unknown[51]
  {
    if(189127 call _cond_test(189091 call !(189090 call isExternArrEltType(189086 call . arr[189071] c"eltType"))))
    {
      (189125 call safeCastCheckHalt(189122 call + "Cannot build an external array that stores "(189120 call _cast string[26](189116 call . arr[189071] c"eltType"))))
      (355151 'used modules list'(189094 'use' HaltWrappers[209910]))
    }
    if(189185 call _cond_test(189142 call !(189141 call isIntegralType(189137 call .(189134 call . arr[189071] c"_dom") c"idxType"))))
    {
      (189182 call compilerError(189179 call + "cannot return an array with indices that are not " "integrals"))
    }
    if(189218 call _cond_test(189193 call .(189190 call . arr[189071] c"_dom") c"stridable"))
    {
      (189215 call compilerError "cannot return a strided array")
    }
    if(189254 call _cond_test(189230 call !=(189226 call .(189223 call . arr[189071] c"_dom") c"rank") 1))
    {
      (189251 call compilerError "cannot return an array with rank != 1")
    }
    if(189290 call _cond_test(189266 call !=(189262 call .(189259 call . arr[189071] c"_dom") c"low") 0))
    {
      (189287 call halt "cannot return an array when the lower bounds is not 0")
    }
    if(189316 call _cond_test(189308 call ||(189299 call ==(189295 call . arr[189071] c"eltType") string[26])(189306 call ==(189302 call . arr[189071] c"eltType") bytes[24])))
    {
      (189314 return(189313 call convertStringOrBytes arr[189071]))
    }
    unknown externalArr[189338](189337 call chpl_make_external_array_ptr_free(189328 call c_ptrTo(189326 call arr[189071] 0))(189335 call _cast uint(64)[115](189331 call . arr[189071] c"size")))
    (189341 'end of statement')
    (189347 call =(189343 call . arr[189071] c"externArr") 1)
    (189355 call =(189351 call . arr[189071] c"_borrowed") 1)
    (189359 return externalArr[189338])
  }
  where {
    (189082 call ==(189080 call getExternalArrayType arr[189071]) chpl_external_array[188595])
  }
  { scopeless type
    chpl_external_array[188595]
  }
  function convertToExternalArray[189373](arg arr[189370] :
  (189367 call chpl__buildArrayRuntimeType nil[44])) : _unknown[51]
  {
    unknown ret[189384] chpl_opaque_array[188575]
    (189387 'end of statement')
    (189397 call =(189390 call . ret[189384] c"_pid")(189394 call . arr[189370] c"_pid"))
    (189411 call =(189401 call . ret[189384] c"_instance")(189409 call _cast c_void_ptr[149](189405 call . arr[189370] c"_value")))
    (189422 call =(189415 call . ret[189384] c"_unowned")(189419 call . arr[189370] c"_unowned"))
    if(189440 call _cond_test(189429 call !(189426 call . arr[189370] c"_unowned")))
    {
      (189436 call =(189432 call . arr[189370] c"_unowned") 1)
    }
    (189445 return ret[189384])
  }
  where {
    (189381 call ==(189379 call getExternalArrayType arr[189370]) chpl_opaque_array[188575])
  }
  { scopeless type
    chpl_opaque_array[188575]
  }
  function isExternArrEltType[189455](arg t[189453]:_any[178](?)) param : _unknown[51] "private"
  {
    if(189510 call _cond_test(189460 call isPrimitive t[189453]))
    {
      (189462 return 1)
    }
    {
      if(189505 call _cond_test(189467 call == t[189453] c_string[19]))
      {
        (189470 return 1)
      }
      {
        if(189501 call _cond_test(189492 'is extern type' t[189453]))
        {
          (189494 return 1)
        }
        {
          (189498 return 0)
        }
      }
    }
  }
  function getExternalArrayType[189522](arg arg[189520]:_any[178](?)) type : _unknown[51]
  {
    if(189575 call _cond_test(189529 call !(189528 call isArrayType(189526 'typeof' arg[189520]))))
    {
      (189550 call compilerError "must call with an array")
    }
    {
      if(189570 call _cond_test(189561 call(189557 call .(189554 call . arg[189520] c"_value") c"isDefaultRectangular")))
      {
        (189563 return chpl_external_array[188595])
      }
      {
        (189567 return chpl_opaque_array[188575])
      }
    }
  }
  function getExternalArrayType[189586](arg arg[189584]:_any[178](?)) type : _unknown[51]
  {
    if(189634 call _cond_test(189592 call !(189591 call isArrayType arg[189584])))
    {
      (189597 call compilerError "must call with an array")
    }
    {
      unknown _instanceType[189605] "type variable"(189604 'static field type' arg[189584] "_instance")
      unknown borrowedAlt[189613] "type variable"(189612 call _to_borrowed _instanceType[189605])
      if(189630 call _cond_test(189621 call(189617 call . borrowedAlt[189613] c"isDefaultRectangular")))
      {
        (189623 return chpl_external_array[188595])
      }
      {
        (189627 return chpl_opaque_array[188575])
      }
    }
  }
  function cleanupOpaqueArray[189647](const  ref arg arr[189644] :
  chpl_opaque_array[188575]) : _unknown[51] "export" "local args" "no return value for void"
  {
    unknown cleanup[189658](189656 call _cast unmanaged BaseArr?[415397](189650 call . arr[189644] c"_instance"))
    (189661 'end of statement')
    if(189675 call _cond_test cleanup[189658])
    {
      (189673 call _do_destroy_arr(189666 call . arr[189644] c"_unowned")(189671 call postfix! cleanup[189658]))
    }
  }
  (355149 'used modules list'(188555 'use' ChapelStandard[20264]))
}